<!DOCTYPE html>
<html>
<head>
    <title><%= title %></title>
    <%include ./partials/critical-css.ejs%>
    <link rel='stylesheet' href='/stylesheets/style.css' />
</head>
<body>
<%include ./partials/header.ejs%>

<!--Temp "under construction" styles-->
<style>
    body {
        height: 100%;
    }

    .signUp {
        display: flex;
        align-items: center;
        height: calc(100vh - 100px);
    }

    .signUpForm {
        margin: 0 auto;
        padding: 1em;
        border: 1px solid #535A6D;
        border-radius: 5px;
        text-align: center;
        font-size: 1em;
    }

    .signUpForm__label {
        display: block;
        text-align: left;
        margin-bottom: 0.15em;
    }

    .signUpForm__input {
        padding: 0.25em;
        margin-bottom: 1em;
        border-radius: 5px;
    }

    .signUpForm__submitBtn {
        display: block;
        margin: 0 auto;
        background-color: transparent;
        border-radius: 5px;
        transition: 0.25s;
        border: 2px solid #535A6D;
        padding: 0.75em;
    }

    .signUpForm__submitBtn:hover {
        background-color: #535A6D;
        color: white;
    }
</style>

<div class="signUp">
    <form class="signUpForm">
        <label for="username" class="signUpForm__label">Username</label>
        <input type="text" name="username" class="signUpForm__input" placeholder="Dude Duderson" required>
        <label for="password" class="signUpForm__label">Password</label>
        <input type="password" name="password" class="signUpForm__input" placeholder="Dudes!!!!" required>
        <button type="submit" class="signUpForm__submitBtn">submit</button>
    </form>
</div>

<script>
    var form = document.querySelector('.signUpForm');
    var eSubmitBtn = document.querySelector('.signUpForm__submitBtn');

    form.querySelector('input').focus();

    form.onsubmit = function(e){

        e.stopPropagation();
        e.preventDefault();

        setSubmittingState(true);
        sendLoginRequest();
    }

    function sendLoginRequest(){
        window.fetch('/api/signUp', {
            method: 'POST',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                username: form.querySelector('.signUpForm__input[name="username"]').value,
                password: form.querySelector('.signUpForm__input[name="password"]').value
            })
        }).then(function(response){ return response.json();
        }).then(function(response){
            setSubmittingState(false);

            window.localStorage.token = response.token;
            window.location = '/';
        }).catch(function(err){
            setSubmittingState(false);
            alert('Your username or password is incorrect');
            window.console.log('failure.', err);
        });
    }

    function setSubmittingState(isSubmitting){
        var message = isSubmitting === true ? 'Submitting...' : 'Submit';
        eSubmitBtn.textContent = message;
        eSubmitBtn.disabled = isSubmitting;
    }
</script>

</body>
</html>